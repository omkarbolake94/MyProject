pipeline {

agent{
 
    dockerfile {args '--user root -v /var/run/docker.sock:/var/run/docker.sock'}
 
}

environment{

registry = "omkarbolake94/myproject"
registryCredential = 'dockerhub2'


}

stages {

      stage('Build Stage'){
	  
	  steps{
          sh 'mvn --version'
	  sh 'pwd'
	  sh 'mvn clean package'
	  
	  }
	  
	  
	  }
	  
	  
	  
	  stage('Build Image'){

environment{


DOCKER_IMAGE = "v:${BUILD_NUMBER}"

}
	  
	  steps {
             
             
	  script {
	  sh 'docker build -t ${DOCKER_IMAGE}  -f Dockerfile2 .'
	
       def dockerImage = docker.image("${DOCKER_IMAGE}")
	  
	  }
	  
	  }
	  
	  }
	  
	  stage('Upload Image to Dockerhub')
	  {
	  steps{
	  script{
	  
	  docker.withRegistry('',registryCredential)
	  {
	  dockerImage.push('latest')
	  }
	  }
	  }
	  }
	  
	  
	  
	  
   
}

}
