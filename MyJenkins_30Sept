pipeline {

agent{
 
    dockerfile {args '--user root -v /var/run/docker.sock:/var/run/docker.sock'}
 
}

environment{

registry = "omkarbolake94/MyProject"
registryCredential = "dockerhub"

}

stages {

      stage('Build Stage'){
	  
	  steps{
          sh 'mvn --version'
	  sh 'pwd'
	  sh 'mvn clean package'
	  
	  }
	  
	  
	  }
	  
	  
	  
	  stage('Build Image'){
	  
	  steps {
	  script {
	  
	  dockerImage = docker.build registry + ":V$BUILD_NUMBER"
	  
	  }
	  
	  }
	  
	  }
	  
	  stage('Upload Image to Dockerhub')
	  {
	  steps{
	  script{
	  
	  docker.withRegistry('',registryCredential)
	  dockerImage.push("V$BUILD_NUMBER")
	  dockerImage.push('Latest')
	  
	  }
	  }
	  }
	  
	  
	  
	  
   
}

}
