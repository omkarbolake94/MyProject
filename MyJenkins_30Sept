pipeline{

agent{
 
    dockerfile {-v root}
 
}

environment{

registry = "omkarbolake94/MyProject"
registryCredential = "dockerhub"

}

stages {

      stage("Build Stage"){
	  
	  steps{
	  
	  sh 'mvn clean install'
	  
	  }
	  
	  
	  }
	  
	  stage("Test")
	  {
	  
	  steps{
	  
	  sh 'mvn test'
	  
	  }
	  
	  }
	  
	  stage("Build Image"){
	  
	  steps {
	  script {
	  
	  dockerImage = docker.build registry + ":V$BUILD_NUMBER"
	  
	  }
	  
	  }
	  
	  }
	  
	  stage("Upload Image to Dockerhub")
	  {
	  steps{
	  script{
	  
	  docker.withRegistry('',registryCredential)
	  dockerImage.push("V$BUILD_NUMBER")
	  dockerImage.push('Latest')
	  
	  }
	  }
	  }
	  
	  
	  
	  
   
}

}
